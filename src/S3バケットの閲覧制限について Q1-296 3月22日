S3バケットの閲覧制限について Q1-296 3月22日

■ 検証
ViewOnlyAccess を付与した上で

下記のポリシーで指定したバケットのみDeny対象から除外したことを確認。
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "DenyEceptSomeBucket",
            "Effect": "Deny",
            "Action": [
                "s3:ListBucket"
            ],
            "NotResource": [
                "arn:aws:s3:::s3.main.bucket"
            ]
        }
    ]
}





平素よりお世話になっております。AWS をご利用頂きまして誠にありがとうございます。

AWS 管理ポリシー ｢ViewOnlyAccess｣ を IAM ユーザーに付与しつつ、オブジェクトの閲覧を特定のバケットのみに制限したい旨、承りました。

まず初めに、S3 で定義されるアクションのリスト [1] でリソース列が空白のアクションはリソースごとの制限が不可能なアクションとなっております。
バケット名一覧を表示する権限 s3:ListAllMyBuckets もリスト [1] でご確認できます通り、リソース列が空白になっており、誠に恐縮ですがこちらの権限も一部のバケット名だけを表示することは出来ず、アカウントが所属するバケット名一覧を表示するか、バケット名を一つも表示しないかのいずれかしか選択出来ないものとなっております。

一方で、各バケット配下にございますオブジェクトやフォルダを閲覧する権限にあたる、s3:ListBucket は特定のバケット配下にあるオブジェクト･フォルダのみの閲覧権限を IAM ユーザー･ロールに付与することが可能でございます。
こちらのご要件を満たすには、カスタマー管理ポリシー [2] を作成頂く必要がございます。
カスタマー管理ポリシー作成の際に、Deny ステートメントを作成し NotResource 句 [3] に明示的拒否対象になるバケット名を記載頂くことで、指定したバケット以外への閲覧権限を明示的に拒否することが可能です。
下記のような IAM ポリシー例では指定したバケット以外の s3:ListBucket の権限を明示的に拒否することが可能です。

--------------- IAM ポリシー例---------------
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "DenyEceptSomeBucket",
            "Effect": "Deny",
            "Action": [
                "s3:ListBucket"
            ],
            "NotResource": ["arn:aws:s3:::<バケット名>"]
        }
    ]
}
----------------------------------------------

AWS 管理ポリシー ｢ViewOnlyAccess｣ に加えて上記ポリシー例のようなカスタマー管理ポリシーを作成し、IAM ユーザー･ロールに付与することで、指定したバケットのみでオブジェクト･フォルダの閲覧が可能になるかと存じます。
<バケット名> には明示的拒否の対象から除外するバケット名(アクセスを許可したいバケット名)を記載頂ければと存じます。

■ 留意点
上記 IAM ポリシー例はあくまでもサンプルでございますため、改めてお客様のユースケースに合うものかご検証頂き、必要に応じて適宜変更頂きますよう、お願い申し上げます。
上記 IAM ポリシー例は s3:ListBucket のようにリスト [1] 上で リソースタイプ列に [bucket*] と記載されている権限限定で適用できるフォーマットです。
オブジェクトを削除する権限にあたる s3:DeleteObject やオブジェクトをアップロード･ダウンロードする権限にあたる s3:PutObject や s3:GetObject のように リスト [1] 上でリソースタイプ列が [object*] になっている権限を上記フォーマットでポリシーの作成ご希望の場合は下記のように NotResource 句を指定してください。
    "NotResource": ["arn:aws:s3:::<バケット名>/*"]

■ 上記案内をご参考にしても、お客様の想定した挙動にならないもしくは問題が発生する場合
お手数ですが下記の情報を添えて、再度お問い合わせ頂きますようお願い申し上げます。

- ご共有頂きたい情報
1. ご利用の IAM ユーザー名
2. お客様が実現したい内容の詳細 (例：ユーザーに許可を出したいアクション、マネージメントコンソールで特定のバケットに対し特定のアクションを許可したい等)
3. 問題の発生している操作について具体的にお知らせください（例：エラーが発生した場合はエラー名やメッセージを添えて頂けますと幸いです。）」

ご案内は以上となりますが、何卒よろしくお願いいたします。

[1] - Amazon S3 で定義されるアクション
https://docs.aws.amazon.com/ja_jp/service-authorization/latest/reference/list_amazons3.html#amazons3-actions-as-permissions

[2] - カスタマー管理ポリシー
https://docs.aws.amazon.com/ja_jp/IAM/latest/UserGuide/access_policies_managed-vs-inline.html#customer-managed-policies

[3] - IAM JSON ポリシーの要素:NotResource 
--------------------抜粋--------------------
NotResource は、指定されたリソースを除くすべてのリソースを明示的に照合する高度なポリシー要素です。
NotResource を使うと、一致する予定のリソースのリストを含めるのではなく、一致する必要がないアクションがいくつかリストアップされ、リソースが短くなります。
これは、単一の AWS のサービス内で適用されるポリシーで特に便利です。 
----------------------------------------------







平素よりお世話になっております。AWS をご利用頂きまして誠にありがとうございます。

AWS 管理ポリシー ｢ViewOnlyAccess｣ を IAM ユーザーに付与しつつ、オブジェクトの閲覧を特定のバケットのみに制限したい旨、承りました。

まず初めに、S3 で定義されるアクションのリスト [1] でリソース列が空白のアクションはリソースごとの制限が不可能なアクションとなっております。
バケット名一覧を表示する権限 s3:ListAllMyBuckets もリスト [1] でご確認できます通り、リソース列が空白になっており、誠に恐縮ですがこちらの権限も一部のバケット名だけを表示することは出来ず、アカウントが所属するバケット名一覧を全て表示するか、バケット名を一つも表示しないかのいずれかしか選択出来ないものとなっております。

一方で、各バケット配下にございますオブジェクトやフォルダを閲覧する権限にあたる、s3:ListBucket は特定のバケット配下にあるオブジェクト･フォルダのみの閲覧権限を IAM ユーザー･ロールに付与することが可能でございます。
こちらのご要件を満たすには、カスタマー管理ポリシー [2] を作成頂く方法がございます。
カスタマー管理ポリシー作成の際に、Deny ステートメントを作成し NotResource 句 [3] に明示的拒否対象から除外したいバケット名を記載頂くことで、指定したバケット以外への閲覧権限を明示的に拒否することが可能です。
下記のような IAM ポリシー例では指定したバケット以外の s3:ListBucket の権限を明示的に拒否することが可能です。

--------------- IAM ポリシー例---------------
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "DenyEceptSomeBucket",
            "Effect": "Deny",
            "Action": [
                "s3:ListBucket"
            ],
            "NotResource": ["arn:aws:s3:::<バケット名>"]
        }
    ]
}
---------------------------------------------------

AWS 管理ポリシー ｢ViewOnlyAccess｣ に加えて上記ポリシー例のようなカスタマー管理ポリシーを作成し、IAM ユーザー･ロールに付与することで、指定したバケットのみでオブジェクト･フォルダの閲覧が可能になるかと存じます。
<バケット名> には明示的拒否の対象から除外するバケット名(アクセスを許可したいバケット名)を記載頂ければと存じます。

■ 留意点
上記 IAM ポリシー例はあくまでもサンプルでございますため、改めてお客様のユースケースに合うものかご検証頂き、必要に応じて適宜変更頂きますよう、お願い申し上げます。
上記 IAM ポリシー例は s3:ListBucket のようにリスト [1] 上で リソースタイプ列に [bucket*] と記載されている権限限定で適用できるフォーマットです。
オブジェクトを削除する権限にあたる s3:DeleteObject やオブジェクトをアップロード･ダウンロードする権限にあたる s3:PutObject や s3:GetObject のように リスト [1] 上でリソースタイプ列が [object*] になっている権限において、上記 IAM ポリシー例のような IAM ポリシーの作成ご希望の場合は下記のように NotResource 句を指定する必要がございます。
    "NotResource": ["arn:aws:s3:::<バケット名>/*"]

■ 上記案内をご参考にしても、お客様の想定した挙動にならないもしくは問題が発生する場合
お手数ですが下記の情報を添えて、再度お問い合わせ頂きますようお願い申し上げます。

- ご共有頂きたい情報
1. ご利用の IAM ユーザー名
2. お客様が実現したい内容の詳細 (例：ユーザーに許可を出したいアクション、マネージメントコンソールで特定のバケットに対し特定のアクションを許可したい等)
3. 問題の発生している操作について具体的にお知らせください（例：エラーが発生した場合はエラー名やメッセージを添えて頂けますと幸いです。）」

ご案内は以上となりますが、何卒よろしくお願いいたします。

[1] - Amazon S3 で定義されるアクション
https://docs.aws.amazon.com/ja_jp/service-authorization/latest/reference/list_amazons3.html#amazons3-actions-as-permissions

[2] - カスタマー管理ポリシー
https://docs.aws.amazon.com/ja_jp/IAM/latest/UserGuide/access_policies_managed-vs-inline.html#customer-managed-policies

[3] - IAM JSON ポリシーの要素:NotResource 
--------------------抜粋--------------------
NotResource は、指定されたリソースを除くすべてのリソースを明示的に照合する高度なポリシー要素です。
NotResource を使うと、一致する予定のリソースのリストを含めるのではなく、一致する必要がないアクションがいくつかリストアップされ、リソースが短くなります。
これは、単一の AWS のサービス内で適用されるポリシーで特に便利です。 
----------------------------------------------




平素よりお世話になっております。AWS をご利用頂きまして誠にありがとうございます。

AWS 管理ポリシー ｢ViewOnlyAccess｣ を IAM ユーザーに付与しつつ、オブジェクトの閲覧を特定のバケットのみに制限したい旨、承りました。

まず初めに、S3 で定義されるアクションのリスト [1] でリソース列が空白のアクションはリソースごとの制限が不可能なアクションとなっております。
バケット名一覧を表示する権限 s3:ListAllMyBuckets もリスト [1] でご確認できます通り、リソース列が空白になっており、誠に恐縮ですがこちらの権限も一部のバケット名だけを表示することは出来ず、アカウントが所属するバケット名一覧を全て表示するか、バケット名を一つも表示しないかのいずれかしか選択出来ないものとなっております。

一方で、各バケット配下にございますオブジェクトやフォルダを閲覧する権限にあたる、s3:ListBucket は特定のバケット配下にあるオブジェクト･フォルダのみの閲覧権限を IAM ユーザー･ロールに付与することが可能でございます。
こちらのご要件を満たすには、カスタマー管理ポリシー [2] を作成頂く方法がございます。
カスタマー管理ポリシー作成の際に、Deny ステートメントを作成し NotResource 句 [3] に明示的拒否対象から除外したいバケット名を記載頂くことで、指定したバケット以外への閲覧権限を明示的に拒否することが可能です。
下記のような IAM ポリシー例では指定したバケット以外の s3:ListBucket の権限を明示的に拒否することが可能です。

--------------- IAM ポリシー例---------------
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "DenyEceptSomeBucket",
            "Effect": "Deny",
            "Action": [
                "s3:ListBucket"
            ],
            "NotResource": ["arn:aws:s3:::<バケット名>"]
        }
    ]
}
---------------------------------------------------

AWS 管理ポリシー ｢ViewOnlyAccess｣ に加えて上記ポリシー例のようなカスタマー管理ポリシーを作成し、IAM ユーザー･ロールに付与することで、指定したバケットのみでオブジェクト･フォルダの閲覧が可能になるかと存じます。
<バケット名> には明示的拒否の対象から除外するバケット名(アクセスを許可したいバケット名)を記載頂ければと存じます。

■ 留意点
上記 IAM ポリシー例はあくまでもサンプルでございますため、改めてお客様のユースケースに合うものかご検証頂き、必要に応じて適宜変更頂きますよう、お願い申し上げます。
上記 IAM ポリシー例は s3:ListBucket のようにリスト [1] 上で リソースタイプ列に [bucket*] と記載されている権限限定で適用できるフォーマットです。
オブジェクトを削除する権限にあたる s3:DeleteObject やオブジェクトをアップロード･ダウンロードする権限にあたる s3:PutObject や s3:GetObject のように リスト [1] 上でリソースタイプ列が [object*] と記載されている権限において、上記 IAM ポリシー例のような IAM ポリシーの作成ご希望の場合は下記のように NotResource 句を指定する必要がございます。
    "NotResource": ["arn:aws:s3:::<バケット名>/*"]

■ 上記案内をご参考にしても、お客様の想定した挙動にならないもしくは問題が発生する場合
お手数ですが下記の情報を添えて、再度お問い合わせ頂きますようお願い申し上げます。

- ご共有頂きたい情報
1. ご利用の IAM ユーザー名
2. お客様が実現したい内容の詳細 (例：ユーザーに許可を出したいアクション、マネージメントコンソールで特定のバケットに対し特定のアクションを許可したい等)
3. 問題の発生している操作について具体的にお知らせください（例：エラーが発生した場合はエラー名やメッセージを添えて頂けますと幸いです。）」

ご案内は以上となりますが、何卒よろしくお願いいたします。

[1] - Amazon S3 で定義されるアクション
https://docs.aws.amazon.com/ja_jp/service-authorization/latest/reference/list_amazons3.html#amazons3-actions-as-permissions

[2] - カスタマー管理ポリシー
https://docs.aws.amazon.com/ja_jp/IAM/latest/UserGuide/access_policies_managed-vs-inline.html#customer-managed-policies

[3] - IAM JSON ポリシーの要素:NotResource 
https://docs.aws.amazon.com/ja_jp/IAM/latest/UserGuide/reference_policies_elements_notresource.html
--------------------抜粋--------------------
NotResource は、指定されたリソースを除くすべてのリソースを明示的に照合する高度なポリシー要素です。
NotResource を使うと、一致する予定のリソースのリストを含めるのではなく、一致する必要がないアクションがいくつかリストアップされ、リソースが短くなります。
これは、単一の AWS のサービス内で適用されるポリシーで特に便利です。 
----------------------------------------------